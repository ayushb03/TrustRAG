>TrustRAGÈ°πÁõÆÂú∞ÂùÄüåüÔºö**[https://github.com/gomate-community/TrustRAG](https://github.com/gomate-community/TrustRAG)**

>ÂèØÈÖçÁΩÆÁöÑÊ®°ÂùóÂåñRAGÊ°ÜÊû∂

## ÁéØÂ¢É‰æùËµñ
Êú¨ÊïôÁ®ãÂü∫‰∫édockerÂÆâË£ÖQdrantÊï∞ÊçÆÂ∫ìÔºåÂú®Ê≠§‰πãÂâçËØ∑ÂÖàÂÆâË£Ödocker.

- Docker - The easiest way to use Qdrant is to run a pre-built Docker image.
- Python version >=3.8

## ÂêØÂä®QdrantÂÆπÂô®
1.ÊãâÂèñÈïúÂÉè
```bash
docker pull qdrant/qdrant
```
2.ÂêØÂä®qdrantÂÆπÂô®ÊúçÂä°

```bash
docker run -d \
    --name qdrant_server \
    -v $(pwd)/qdrant_storage:/qdrant/storage \
    -p 6333:6333 \
    qdrant/qdrant
```

- ‰ªé `qdrant/qdrant` ÈïúÂÉèÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ `qdrant_server` ÁöÑÂÆπÂô®„ÄÇ
- Â∞ÜÂÆø‰∏ªÊú∫ÁöÑ `$(pwd)/qdrant_storage` ÁõÆÂΩïÊåÇËΩΩÂà∞ÂÆπÂô®ÁöÑ `/qdrant/storage` ÁõÆÂΩïÔºå‰ª•ÂÆûÁé∞Êï∞ÊçÆÊåÅ‰πÖÂåñ„ÄÇ
- Â∞ÜÂÆø‰∏ªÊú∫ÁöÑ `6333` Á´ØÂè£Êò†Â∞ÑÂà∞ÂÆπÂô®ÁöÑ `6333` Á´ØÂè£Ôºå‰ª•‰æøÈÄöËøáÂÆø‰∏ªÊú∫ËÆøÈóÆ Qdrant ÊúçÂä°„ÄÇ
- ÂÆπÂô®Âú®ÂêéÂè∞ËøêË°åÔºå‰∏ç‰ºöÂç†Áî®ÂΩìÂâçÁªàÁ´Ø„ÄÇ

```bash
docker logs qdrant_server
```
ÂèØ‰ª•ÁúãÂà∞‰∏ãÈù¢Êó•ÂøóÔºö
![](https://i-blog.csdnimg.cn/direct/9d0cc450ce534d8d984788ce08c3bc1e.png)
ÈÄöËøá http://localhost:6333/dashboard Âú∞ÂùÄËÆøÈóÆweb ui
![](https://i-blog.csdnimg.cn/direct/9a0d77c43f0249fb9d41d2b34950eadc.png)
## Âü∫‰∫éRESTful API Êìç‰ΩúÂêëÈáèÊï∞ÊçÆÂ∫ì
### Á¨¨‰∏ÄÊ≠•ÔºöÂàõÂª∫‰∏Ä‰∏™ÈõÜÂêà
>QdrantÂêëÈáèÊï∞ÊçÆÂ∫ìÁöÑÈõÜÂêàÊ¶ÇÂøµÂèØ‰ª•Á±ªÊØîMYSQLÁöÑË°®ÁªìÊûÑÔºåÁî®‰∫éÁªü‰∏ÄÂ≠òÂÇ®Âêå‰∏ÄÁ±ªÂêëÈáèÊï∞ÊçÆÔºåÈõÜÂêà‰∏≠Â≠òÂÇ®ÁöÑÊØè‰∏ÄÊù°Êï∞ÊçÆÔºåÂú®Qdrant‰∏≠Áß∞‰∏∫ÁÇπÔºàpointsÔºâÔºåËøôÈáåÁöÑÁÇπÊúâÊï∞Â≠¶Âá†‰ΩïÁ©∫Èó¥ÁöÑÁÇπÁ±ª‰ººÁöÑÊÑèÊÄùÔºå‰ª£Ë°®ÂêëÈáèÂú®Âá†‰ΩïÁ©∫Èó¥‰∏≠ÁöÑË°®Á§∫Ôºà‰Ω†Â∞±ÂΩìÊàê‰∏ÄÊù°Êï∞ÊçÆÁúãÂæÖÂ∞±Ë°åÔºâ„ÄÇ


È¶ñÂÖàÔºåÊàë‰ª¨ÈúÄË¶ÅÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ `star_charts` ÁöÑÈõÜÂêàÔºåÁî®Êù•Â≠òÂÇ®ÊÆñÊ∞ëÂú∞Êï∞ÊçÆ„ÄÇÊØè‰∏™‰ΩçÁΩÆÈÉΩ‰ºöÁî®‰∏Ä‰∏™ÂõõÁª¥ÂêëÈáèÊù•Ë°®Á§∫ÔºåÂπ∂‰∏îÊàë‰ª¨‰ºö‰ΩøÁî®ÁÇπÁßØÔºàDot ProductÔºâ‰Ωú‰∏∫Áõ∏‰ººÂ∫¶ÊêúÁ¥¢ÁöÑË∑ùÁ¶ªÂ∫¶Èáè„ÄÇ

ËøêË°å‰ª•‰∏ãÂëΩ‰ª§Êù•ÂàõÂª∫ÈõÜÂêàÔºö

```json
PUT collections/star_charts
{
  "vectors": {
    "size": 4,
    "distance": "Dot"
  }
}
```

### Á¨¨‰∫åÊ≠•ÔºöÂ∞ÜÊï∞ÊçÆÂä†ËΩΩÂà∞ÈõÜÂêà‰∏≠
>ÂàõÂª∫Â•ΩÈõÜÂêà‰πãÂêéÔºåÊàë‰ª¨ÂèØ‰ª•ÂêëÈõÜÂêàÊ∑ªÂä†ÂêëÈáèÊï∞ÊçÆÔºåÂú®Qdrant‰∏≠ÂêëÈáèÊï∞ÊçÆ‰ΩøÁî®pointË°®Á§∫Ôºå‰∏ÄÊù°pointÊï∞ÊçÆÂåÖÊã¨‰∏âÈÉ®ÂàÜid„ÄÅpayload(ÂÖ≥ËÅîÊï∞ÊçÆ)„ÄÅÂêëÈáèÊï∞ÊçÆÔºàvectorÔºâ‰∏âÈÉ®ÂàÜ„ÄÇ


Áé∞Âú®ÈõÜÂêàÂ∑≤ÁªèËÆæÁΩÆÂ•Ω‰∫ÜÔºåÊé•‰∏ãÊù•Êàë‰ª¨Ê∑ªÂä†‰∏Ä‰∫õÊï∞ÊçÆ„ÄÇÊØè‰∏™‰ΩçÁΩÆÈÉΩ‰ºöÊúâ‰∏Ä‰∏™ÂêëÈáèÂíå‰∏Ä‰∫õÈ¢ùÂ§ñÁöÑ‰ø°ÊÅØÔºàÁß∞‰∏∫ payloadÔºâÔºåÊØîÂ¶ÇÂÆÉÁöÑÂêçÂ≠ó„ÄÇ

ËøêË°å‰ª•‰∏ãËØ∑Ê±ÇÊù•Ê∑ªÂä†Êï∞ÊçÆÔºö

```json
PUT collections/star_charts/points
{
  "points": [
    {
      "id": 1,
      "vector": [0.05, 0.61, 0.76, 0.74],
      "payload": {
        "colony": "Mars"
      }
    },
    {
      "id": 2,
      "vector": [0.19, 0.81, 0.75, 0.11],
      "payload": {
        "colony": "Jupiter"
      }
    },
    {
      "id": 3,
      "vector": [0.36, 0.55, 0.47, 0.94],
      "payload": {
        "colony": "Venus"
      }
    },
    {
      "id": 4,
      "vector": [0.18, 0.01, 0.85, 0.80],
      "payload": {
        "colony": "Moon"
      }
    },
    {
      "id": 5,
      "vector": [0.24, 0.18, 0.22, 0.44],
      "payload": {
        "colony": "Pluto"
      }
    }
  ]
}
```

### Á¨¨‰∏âÊ≠•ÔºöËøêË°åÊêúÁ¥¢Êü•ËØ¢
Áé∞Âú®ÔºåÊàë‰ª¨Êù•ÊêúÁ¥¢‰∏Ä‰∏ã‰∏éÊüê‰∏™ÁâπÂÆöÂêëÈáèÔºà‰ª£Ë°®‰∏Ä‰∏™Á©∫Èó¥‰ΩçÁΩÆÔºâÊúÄÊé•ËøëÁöÑ‰∏â‰∏™ÊÆñÊ∞ëÂú∞„ÄÇËøô‰∏™Êü•ËØ¢‰ºöËøîÂõûËøô‰∫õÊÆñÊ∞ëÂú∞‰ª•ÂèäÂÆÉ‰ª¨ÁöÑ payload ‰ø°ÊÅØ„ÄÇ

ËøêË°å‰ª•‰∏ãÊü•ËØ¢Êù•ÊâæÂà∞ÊúÄËøëÁöÑÊÆñÊ∞ëÂú∞Ôºö

```json
POST collections/star_charts/points/search
{
  "vector": [0.2, 0.1, 0.9, 0.7],
  "limit": 3,
  "with_payload": true
}
```

ËøôÊ†∑Ôºå‰Ω†Â∞±ÂèØ‰ª•ÊâæÂà∞‰∏éÁªôÂÆöÂêëÈáèÊúÄÊé•ËøëÁöÑ‰∏â‰∏™ÊÆñÊ∞ëÂú∞‰∫ÜÔºÅ
![](https://i-blog.csdnimg.cn/direct/876f3dc307f149e995c5f0bb52b18760.png)

---

‰∏äÈù¢ÂëΩ‰ª§ÔºåÊàë‰ª¨ÈÉΩÂèØ‰ª•Âú®Èù¢ÊùøÈáåÈù¢ÊâßË°åÔºå
![](https://i-blog.csdnimg.cn/direct/840bb62d209140cebfcfd781122fadf8.png)
ÁÇπÂáªÈõÜÂêàÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨ÂàöÂàöÂàõÂª∫ÁöÑ‰æãÂ≠êÔºö
![](https://i-blog.csdnimg.cn/direct/fe5eb121f3aa492791c3ca35453325dc.png)
ÁÇπÂáªÂèØËßÜÂåñÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÈõÜÂêàÈáåÈù¢ÁöÑÂêëÈáè(point)
![](https://i-blog.csdnimg.cn/direct/cd3ccf1711914af3a2d79729d8eb4b14.png)
Êõ¥Â§öÈ´òÁ∫ßÁî®Ê≥ïÂèØ‰ª•Êü•ÁúãÈù¢Êùø‰∏≠ÁöÑÊïôÁ®ãÔºö
>http://localhost:6333/dashboard#/tutorial

## Âü∫‰∫éqdrant_clientÊìç‰ΩúÂêëÈáèÊï∞ÊçÆÂ∫ì
‰ª•‰∏ãÊòØÂ∞Ü‰∏äËø∞ÂÜÖÂÆπËΩ¨Êç¢‰∏∫ Markdown Ê†ºÂºèÁöÑÁâàÊú¨Ôºö

```markdown
# Qdrant Âø´ÈÄüÂÖ•Èó®ÊåáÂçó

## ÂÆâË£Ö `qdrant-client` ÂåÖÔºàPythonÔºâ

```bash
pip install qdrant-client
```

### ÂàùÂßãÂåñÂÆ¢Êà∑Á´Ø

```python
from qdrant_client import QdrantClient

client = QdrantClient(url="http://localhost:6333")
```

### ÂàõÂª∫ Collection

ÊâÄÊúâÁöÑÂêëÈáèÊï∞ÊçÆÔºàvector dataÔºâÈÉΩÂ≠òÂÇ®Âú® Qdrant Collection ‰∏ä„ÄÇÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ `test_collection` ÁöÑ collectionÔºåËØ• collection ‰ΩøÁî® `dot product` ‰Ωú‰∏∫ÊØîËæÉÂêëÈáèÁöÑÊåáÊ†á„ÄÇ

```python
from qdrant_client.models import Distance, VectorParams

client.create_collection(
    collection_name="test_collection",
    vectors_config=VectorParams(size=4, distance=Distance.DOT),
)
```

### Ê∑ªÂä†Â∏¶ Payload ÁöÑÂêëÈáè

Payload ÊòØ‰∏éÂêëÈáèÁõ∏ÂÖ≥ËÅîÁöÑÊï∞ÊçÆ„ÄÇ

```python
from qdrant_client.models import PointStruct

operation_info = client.upsert(
    collection_name="test_collection",
    wait=True,
    points=[
        PointStruct(id=1, vector=[0.05, 0.61, 0.76, 0.74], payload={"city": "Berlin"}),
        PointStruct(id=2, vector=[0.19, 0.81, 0.75, 0.11], payload={"city": "London"}),
        PointStruct(id=3, vector=[0.36, 0.55, 0.47, 0.94], payload={"city": "Moscow"}),
        PointStruct(id=4, vector=[0.18, 0.01, 0.85, 0.80], payload={"city": "New York"}),
        PointStruct(id=5, vector=[0.24, 0.18, 0.22, 0.44], payload={"city": "Beijing"}),
        PointStruct(id=6, vector=[0.35, 0.08, 0.11, 0.44], payload={"city": "Mumbai"}),
    ]
)

print(operation_info)
```

### ËøêË°åÊü•ËØ¢

```python
search_result = client.query_points(
    collection_name="test_collection", query=[0.2, 0.1, 0.9, 0.7], limit=3
).points

print(search_result)
```

### ËæìÂá∫

```json
[
  {
    "id": 4,
    "version": 0,
    "score": 1.362,
    "payload": null,
    "vector": null
  },
  {
    "id": 1,
    "version": 0,
    "score": 1.273,
    "payload": null,
    "vector": null
  },
  {
    "id": 3,
    "version": 0,
    "score": 1.208,
    "payload": null,
    "vector": null
  }
]
```

### Ê∑ªÂä†ËøáÊª§Âô®

```python
from qdrant_client.models import Filter, FieldCondition, MatchValue

search_result = client.query_points(
    collection_name="test_collection",
    query=[0.2, 0.1, 0.9, 0.7],
    query_filter=Filter(
        must=[FieldCondition(key="city", match=MatchValue(value="London"))]
    ),
    with_payload=True,
    limit=3,
).points

print(search_result)
```


```json
[
    {
        "id": 2,
        "version": 0,
        "score": 0.871,
        "payload": {
            "city": "London"
        },
        "vector": null
    }
]
```


## ËØ≠‰πâÊêúÁ¥¢ÂÖ•Èó®ÂÆûÁé∞
‰ª•ÂÆòÊñπÊïôÁ®ã‰∏∫‰æãÔºåÊàëÂú®TrustRAG‰∏≠ÂØπQdrantËøõË°å‰∫ÜÂ∞ÅË£ÖÊîπÈÄ†Ôºö

>ÂÆòÊñπÊïôÁ®ãÔºö[https://qdrant.tech/documentation/beginner-tutorials/neural-search/](https://qdrant.tech/documentation/beginner-tutorials/neural-search/)
>TrusRAGÂÆûÁé∞‰ª£Á†Å`QdrantEngine`:[https://github.com/gomate-community/TrustRAG/blob/main/trustrag/modules/engine/qdrant.py](https://github.com/gomate-community/TrustRAG/blob/main/trustrag/modules/engine/qdrant.py)

‰ª•‰∏ã‰∏∫‰ΩøÁî®ÂÆåÊï¥‰ª£Á†ÅÔºö
```python
from trustrag.modules.engine.qdrant import QdrantEngine
from trustrag.modules.engine.qdrant import SentenceTransformerEmbedding
if __name__ == "__main__":
    # Initialize embedding generators
    local_embedding_generator = SentenceTransformerEmbedding(model_name_or_path="all-MiniLM-L6-v2", device="cpu")
    # openai_embedding_generator = OpenAIEmbedding(api_key="your_key", base_url="https://ark.cn-beijing.volces.com/api/v3", model="your_model_id")

    # Initialize QdrantEngine with local embedding generator
    qdrant_engine = QdrantEngine(
        collection_name="startups",
        embedding_generator=local_embedding_generator,
        qdrant_client_params={"host": "192.168.1.5", "port": 6333},
    )

    documents=[
        {"name": "SaferCodes", "images": "https:\/\/safer.codes\/img\/brand\/logo-icon.png",
         "alt": "SaferCodes Logo QR codes generator system forms for COVID-19",
         "description": "QR codes systems for COVID-19.\nSimple tools for bars, restaurants, offices, and other small proximity businesses.",
         "link": "https:\/\/safer.codes", "city": "Chicago"},
        {"name": "Human Practice",
         "images": "https:\/\/d1qb2nb5cznatu.cloudfront.net\/startups\/i\/373036-94d1e190f12f2c919c3566ecaecbda68-thumb_jpg.jpg?buster=1396498835",
         "alt": "Human Practice -  health care information technology",
         "description": "Point-of-care word of mouth\nPreferral is a mobile platform that channels physicians\u2019 interest in networking with their peers to build referrals within a hospital system.\nHospitals are in a race to employ physicians, even though they lose billions each year ($40B in 2014) on employment. Why ...",
         "link": "http:\/\/humanpractice.com", "city": "Chicago"},
        {"name": "StyleSeek",
         "images": "https:\/\/d1qb2nb5cznatu.cloudfront.net\/startups\/i\/3747-bb0338d641617b54f5234a1d3bfc6fd0-thumb_jpg.jpg?buster=1329158692",
         "alt": "StyleSeek -  e-commerce fashion mass customization online shopping",
         "description": "Personalized e-commerce for lifestyle products\nStyleSeek is a personalized e-commerce site for lifestyle products.\nIt works across the style spectrum by enabling users (both men and women) to create and refine their unique StyleDNA.\nStyleSeek also promotes new products via its email newsletter, 100% personalized ...",
         "link": "http:\/\/styleseek.com", "city": "Chicago"},
        {"name": "Scout",
         "images": "https:\/\/d1qb2nb5cznatu.cloudfront.net\/startups\/i\/190790-dbe27fe8cda0614d644431f853b64e8f-thumb_jpg.jpg?buster=1389652078",
         "alt": "Scout -  security consumer electronics internet of things",
         "description": "Hassle-free Home Security\nScout is a self-installed, wireless home security system. We've created a more open, affordable and modern system than what is available on the market today. With month-to-month contracts and portable devices, Scout is a renter-friendly solution for the other ...",
         "link": "http:\/\/www.scoutalarm.com", "city": "Chicago"},
        {"name": "Invitation codes", "images": "https:\/\/invitation.codes\/img\/inv-brand-fb3.png",
         "alt": "Invitation App - Share referral codes community ",
         "description": "The referral community\nInvitation App is a social network where people post their referral codes and collect rewards on autopilot.",
         "link": "https:\/\/invitation.codes", "city": "Chicago"},
        {"name": "Hyde Park Angels",
         "images": "https:\/\/d1qb2nb5cznatu.cloudfront.net\/startups\/i\/61114-35cd9d9689b70b4dc1d0b3c5f11c26e7-thumb_jpg.jpg?buster=1427395222",
         "alt": "Hyde Park Angels - ",
         "description": "Hyde Park Angels is the largest and most active angel group in the Midwest. With a membership of over 100 successful entrepreneurs, executives, and venture capitalists, the organization prides itself on providing critical strategic expertise to entrepreneurs and ...",
         "link": "http:\/\/hydeparkangels.com", "city": "Chicago"},
        {"name": "GiveForward",
         "images": "https:\/\/d1qb2nb5cznatu.cloudfront.net\/startups\/i\/1374-e472ccec267bef9432a459784455c133-thumb_jpg.jpg?buster=1397666635",
         "alt": "GiveForward -  health care startups crowdfunding",
         "description": "Crowdfunding for medical and life events\nGiveForward lets anyone to create a free fundraising page for a friend or loved one's uncovered medical bills, memorial fund, adoptions or any other life events in five minutes or less. Millions of families have used GiveForward to raise more than $165M to let ...",
         "link": "http:\/\/giveforward.com", "city": "Chicago"},
        {"name": "MentorMob",
         "images": "https:\/\/d1qb2nb5cznatu.cloudfront.net\/startups\/i\/19374-3b63fcf38efde624dd79c5cbd96161db-thumb_jpg.jpg?buster=1315734490",
         "alt": "MentorMob -  digital media education ventures for good crowdsourcing",
         "description": "Google of Learning, indexed by experts\nProblem: Google doesn't index for learning. Nearly 1 billion Google searches are done for \"how to\" learn various topics every month, from photography to entrepreneurship, forcing learners to waste their time sifting through the millions of results.\nMentorMob is ...",
         "link": "http:\/\/www.mentormob.com", "city": "Chicago"},
        {"name": "The Boeing Company",
         "images": "https:\/\/d1qb2nb5cznatu.cloudfront.net\/startups\/i\/49394-df6be7a1eca80e8e73cc6699fee4f772-thumb_jpg.jpg?buster=1406172049",
         "alt": "The Boeing Company -  manufacturing transportation", "description": "",
         "link": "http:\/\/www.boeing.com", "city": "Berlin"},
        {"name": "NowBoarding \u2708\ufe0f",
         "images": "https:\/\/static.above.flights\/img\/lowcost\/envelope_blue.png",
         "alt": "Lowcost Email cheap flights alerts",
         "description": "Invite-only mailing list.\n\nWe search the best weekend and long-haul flight deals\nso you can book before everyone else.",
         "link": "https:\/\/nowboarding.club\/", "city": "Berlin"},
        {"name": "Rocketmiles",
         "images": "https:\/\/d1qb2nb5cznatu.cloudfront.net\/startups\/i\/158571-e53ddffe9fb3ed5e57080db7134117d0-thumb_jpg.jpg?buster=1361371304",
         "alt": "Rocketmiles -  e-commerce online travel loyalty programs hotels",
         "description": "Fueling more vacations\nWe enable our customers to travel more, travel better and travel further. 20M+ consumers stock away miles & points to satisfy their wanderlust.\nFlying around or using credit cards are the only good ways to fill the stockpile today. We've built the third way. Customers ...",
         "link": "http:\/\/www.Rocketmiles.com", "city": "Berlin"}

    ]
    vectors = qdrant_engine.embedding_generator.generate_embedding([doc["description"] for doc in documents])
    print(vectors.shape)
    payload = [doc for doc  in documents]

    # Upload vectors and payload
    qdrant_engine.upload_vectors(vectors=vectors, payload=payload)

    # Build a filter for city and category
    conditions = [
        {"key": "city", "match": "Berlin"},
    ]
    custom_filter = qdrant_engine.build_filter(conditions)

    # Search for startups related to "vacations" in Berlin
    results = qdrant_engine.search(text="vacations", query_filter=custom_filter, limit=5)
    for result in results:
        print(result)
```

## ÂèÇËÄÉËµÑÊñô

- ÂÆòÊñπÊïôÁ®ãÔºö[https://qdrant.tech/documentation/beginner-tutorials/search-beginners/](https://qdrant.tech/documentation/beginner-tutorials/search-beginners/)
- QdrantÂêëÈáèÊï∞ÊçÆÂ∫ì‰ªãÁªçÔºö[https://www.tizi365.com/topic/8144.html](https://www.tizi365.com/topic/8144.html)
- QdrantÂÆòÊñπÂø´ÈÄüÂÖ•Èó®ÂíåÊïôÁ®ãÁÆÄÂåñÁâàÔºö[https://www.cnblogs.com/shizidushu/p/18385637](https://www.cnblogs.com/shizidushu/p/18385637)
- „ÄêRAGÂà©Âô®„ÄëÂêëÈáèÊï∞ÊçÆÂ∫ìqdrantÂêÑÁßçÁî®Ê≥ïÔºåÂ§öÁßçembeddingÁîüÊàêÊñπÊ≥ï 
Ôºö[https://www.cnblogs.com/zxporz/p/18336698](https://www.cnblogs.com/zxporz/p/18336698)

